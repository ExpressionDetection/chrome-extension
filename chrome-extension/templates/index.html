<div id="expression-detection-custom-container">
  <div class="tab-container animate-expression-detection-iframe">
  </div>

  <div class="custom-container">
    <div class="header-container">
      <img class="header-close" />
    </div>
    <div class="iframe-container">
      <iframe
        id="iframe-expression-detection"
        class="frame"
        src="http://localhost:3000/start"
        frameborder="0"
        marginwidth="0"
        marginheight="0"
        scrolling="auto"
        onload=""
        allowtransparency="false"
      >
      </iframe>
      <script text="javascript" id="iframe-script">
        function captureVideo(video) {
          const canvas = document.createElement("canvas");
          canvas.width = video.videoWidth;
          canvas.height = video.videoHeight;
          const canvasContext = canvas.getContext("2d");
          canvasContext.drawImage(video, 0, 0);
          // Get video content in base64
          const dataURL = canvas.toDataURL("image/png");
          return {
            dataURL,
            width: video.videoWidth,
            height: video.videoHeight,
          };
        }

        const intervalTimeBetweenFramesInSeconds = 1 // 1 second

        setInterval(() => {
          // Retrieve our custom made IFrame 
          const iFrame = document.querySelector("#iframe-expression-detection");

          // Query for "video" class inside the page to extract video (Google Meet, Microsoft Teams, etc..)
          const video = document.querySelector("video");

          // TODO: select a specific video feed if "video" is an array

          // Send video frame to our custom IFrame
          if (video) {
            const { dataURL: frame, width, height } = captureVideo(video);
            iFrame.contentWindow.postMessage({ type: "expression-detection.SendFrame", frame }, "*");
          }
        }, intervalTimeBetweenFramesInSeconds * 1000);
      </script>
    </div>
  </div>
</div>
